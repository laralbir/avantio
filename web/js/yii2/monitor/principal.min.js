var monitores=null;var xhrArray=new Array();$(document).ready(initMonitorMain);function initMonitorMain(){$("#btn-cargar-resumen-monitores").click(function(){getResumenMonitores()});getMonitores()}function getMonitores(){$.get(baseURL+"/monitor/principal/get-monitores",null,null,"json").done(function(a){if(!a.error){monitores=a.monitores;$("#tabla-monitor-principal > tbody").empty();for(i=0;i<monitores.length;i++){$("#tabla-monitor-principal > tbody").append('<tr fila-id-monitor="'+monitores[i]["id"]+'">\n                                <td>'+monitores[i]["descripcion"]+'</td>\n                                <td class="text-center"><span data-id="'+monitores[i]["id"]+'" class="badge badge-pill badge-danger badge-xl alerta-error">0</span></td>\n                                <td class="text-center"><span data-id="'+monitores[i]["id"]+'" class="badge badge-pill badge-warning badge-xl alerta-aviso">0</span></td>\n                            </tr>')}$(".alerta-error").click(function(b){b.stopPropagation();window.location.href=baseURL+"/monitor/listado/"+$(this).attr("data-id")+"?n=1&v=1"});$(".alerta-aviso").click(function(b){b.stopPropagation();window.location.href=baseURL+"/monitor/listado/"+$(this).attr("data-id")+"?n=4&v=1"});getResumenMonitores()}}).always(function(a){}).fail(function(a){})}function getResumenMonitores(){abortarXHR(xhrArray);for(i=0;i<monitores.length;i++){var b=$("[fila-id-monitor="+monitores[i]["id"]+"]").get();$(b).find("td:nth-child(1)").find("span").remove();$(b).find("td:nth-child(1)").find("div").remove();$(b).find("td:nth-child(1)").prepend('<div class="loader-xs mr-2"></div>');var a={id:monitores[i]["id"]};var c=$.get(baseURL+"/monitor/principal/get-resumen-monitor",a,null,"json").done(function(d){var e=$("[fila-id-monitor="+d.id_monitor+"]").get();$(e).removeClass("table-danger");$(e).removeClass("table-warning");if(!d.error){if(d.resumen["total_errores"]>0){$(e).addClass("table-danger")}else{if(d.resumen["total_avisos"]>0){$(e).addClass("table-warning")}}$(e).find("td:nth-child(2)").find("span").html(d.resumen["total_errores"]);$(e).find("td:nth-child(3)").find("span").html(d.resumen["total_avisos"])}else{$(e).find("td:nth-child(1)").prepend('<span class="badge badge-danger mr-2">¡FALLO!</span>');$(e).find("td:nth-child(2)").find("span").html("0");$(e).find("td:nth-child(3)").find("span").html("0")}}).always(function(d){var e=$("[fila-id-monitor="+d.id_monitor+"]").get();$(e).find("td:nth-child(1)").find("div").remove()}).fail(function(d){var e=$("[fila-id-monitor="+d.id_monitor+"]").get();$(e).find("td:nth-child(1)").prepend('<span class="badge badge-danger mr-2">¡FALLO!</span>')});c.id_monitor=monitores[i]["id"];xhrArray.push(c)}$("#tabla-monitor-principal > tbody > tr").unbind("click");$("#tabla-monitor-principal > tbody > tr").click(function(){window.location.href=baseURL+"/monitor/listado/"+$(this).attr("fila-id-monitor")})};